<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>codetbase | ì–´ë“œë¯¼</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #f4f7fa; padding: 20px; }
        .container { max-width: 900px; margin: auto; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; }
        input { width: 100%; padding: 10px; margin: 5px 0 15px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; font-size: 14px; }
        .btn { padding: 10px 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-add { background: #0052D4; color: white; width: 100%; }
        .btn-del { background: #ff4d4d; color: white; padding: 5px 10px; }
        .btn-edit { background: #333; color: white; padding: 5px 10px; margin-right: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ’ codetbase ê´€ë¦¬ì ì„¼í„°</h2>

    <div class="card">
        <h3>ğŸ“¢ ê´‘ê³ (ë°°ë„ˆ) ë“±ë¡ ë° ìˆ˜ì •</h3>
        <input type="hidden" id="edit-id">
        <label>ê´‘ê³  ì œëª©</label><input type="text" id="ad-title" placeholder="ì˜ˆ: ë„¤ì´ë²„ í˜ì´ ì´ë²¤íŠ¸">
        <label>ì ë¦½ ìºì‹œ</label><input type="number" id="ad-reward" placeholder="ì˜ˆ: 100">
        <label>ê´‘ê³  ë§í¬ (ì´ë™í•  URL)</label><input type="text" id="ad-link" placeholder="https://...">
        <label>ë°°ë„ˆ ì´ë¯¸ì§€ (ì´ë¯¸ì§€ URL)</label><input type="text" id="ad-img" placeholder="https://.../banner.jpg">
        <button class="btn btn-add" onclick="saveAd()">ê´‘ê³  ì €ì¥í•˜ê¸° (ì‹ ê·œ/ìˆ˜ì •)</button>
    </div>

    <div class="card">
        <h3>ğŸ“‹ í˜„ì¬ ë“±ë¡ëœ ê´‘ê³  ë¦¬ìŠ¤íŠ¸</h3>
        <table id="ad-table">
            <thead><tr><th>ë°°ë„ˆ</th><th>ì œëª©</th><th>ê¸ˆì•¡</th><th>ê´€ë¦¬</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
    const client = supabase.createClient('URL', 'KEY');

    // ê´‘ê³  ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadAds() {
        const { data: ads } = await client.from('ads').select('*').order('created_at', {ascending:false});
        const tbody = document.querySelector('#ad-table tbody');
        tbody.innerHTML = '';
        ads.forEach(ad => {
            tbody.innerHTML += `
                <tr>
                    <td><img src="${ad.image_url}" width="60" style="border-radius:4px;"></td>
                    <td>${ad.title}</td>
                    <td>${ad.reward_cash}c</td>
                    <td>
                        <button class="btn btn-edit" onclick="editAd('${ad.id}','${ad.title}',${ad.reward_cash},'${ad.link_url}','${ad.image_url}')">ìˆ˜ì •</button>
                        <button class="btn btn-del" onclick="deleteAd('${ad.id}')">ì‚­ì œ</button>
                    </td>
                </tr>`;
        });
    }

    // ì €ì¥ (ì‹ ê·œ ë˜ëŠ” ìˆ˜ì •)
    async function saveAd() {
        const id = document.getElementById('edit-id').value;
        const payload = {
            title: document.getElementById('ad-title').value,
            reward_cash: document.getElementById('ad-reward').value,
            link_url: document.getElementById('ad-link').value,
            image_url: document.getElementById('ad-img').value
        };

        if(id) { await client.from('ads').update(payload).eq('id', id); } 
        else { await client.from('ads').insert([payload]); }
        
        alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
        location.reload();
    }

    // ìˆ˜ì • ëª¨ë“œ ì „í™˜
    function editAd(id, t, r, l, i) {
        document.getElementById('edit-id').value = id;
        document.getElementById('ad-title').value = t;
        document.getElementById('ad-reward').value = r;
        document.getElementById('ad-link').value = l;
        document.getElementById('ad-img').value = i;
        window.scrollTo(0, 0); // í™”ë©´ ìœ„ë¡œ ì˜¬ë¦¬ê¸°
    }

    // ì‚­ì œ
    async function deleteAd(id) {
        if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            await client.from('ads').delete().eq('id', id);
            loadAds();
        }
    }

    loadAds();
</script>
</body>
</html>
