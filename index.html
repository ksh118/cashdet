<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìºì‹œëƒ - ë³´ëŠ” ê²ƒë§Œìœ¼ë¡œ ìˆ˜ìµ ì°½ì¶œ</title>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --glass: rgba(255, 255, 255, 0.95);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
            color: #1a1a1a;
            padding-bottom: 90px;
        }
        .container { max-width: 600px; margin: 0 auto; background: #fff; min-height: 100vh; position: relative; }
        
        /* í—¤ë” ë””ìì¸ ê°œì„  */
        .header {
            background: var(--primary-gradient);
            color: white;
            padding: 30px 20px;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }
        .user-info { display: flex; justify-content: space-between; align-items: flex-end; }
        .greeting { font-size: 14px; opacity: 0.9; margin-bottom: 5px; }
        .cash-display { font-size: 32px; font-weight: 800; letter-spacing: -0.5px; }
        .cash-unit { font-size: 18px; font-weight: 400; margin-left: 2px; }

        /* ë°°ë„ˆ ìŠ¬ë¼ì´ë” ìŠ¬ë¦¼í™” */
        .banner-section { padding: 20px; margin-top: -10px; }
        .banner-slider {
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        .banner-container { display: flex; transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .banner-slide { min-width: 100%; height: 160px; }
        .banner-image { width: 100%; height: 100%; object-fit: cover; }

        /* ë¯¸ì…˜ ì„¹ì…˜ ë””ìì¸ ì—…ê·¸ë ˆì´ë“œ */
        .missions-section { padding: 10px 20px; }
        .section-header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 20px; padding: 0 5px;
        }
        .section-title { font-size: 20px; font-weight: 700; color: #333; }
        .view-all { color: #667eea; text-decoration: none; font-size: 14px; font-weight: 600; }

        .mission-card {
            background: #fff;
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }
        .mission-card:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); border-color: #667eea; }
        .mission-img { width: 70px; height: 70px; border-radius: 15px; object-fit: cover; }
        .mission-info { flex: 1; }
        .mission-name { font-weight: 700; font-size: 16px; margin-bottom: 4px; color: #2d3436; }
        .mission-tag { font-size: 12px; color: #95a5a6; display: flex; align-items: center; gap: 4px; }
        .reward-badge {
            background: #f0f4ff;
            color: #667eea;
            padding: 8px 15px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 14px;
        }

        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ì• ë‹ˆë©”ì´ì…˜ */
        .bottom-nav {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            max-width: 600px; width: 100%; background: var(--glass);
            backdrop-filter: blur(10px); display: flex; padding: 12px 0;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05); border-radius: 25px 25px 0 0;
        }
        .nav-item { flex: 1; text-align: center; text-decoration: none; color: #bdc3c7; transition: 0.3s; }
        .nav-item.active { color: #667eea; }
        .nav-icon { font-size: 22px; display: block; margin-bottom: 4px; }
        .nav-label { font-size: 11px; font-weight: 600; }

        /* í‘¸í„° ì •ë³´ */
        .footer {
            padding: 40px 20px; text-align: center; background: #f9f9f9;
            font-size: 12px; color: #999; line-height: 1.8;
        }
        .footer-links { margin-bottom: 15px; display: flex; justify-content: center; gap: 10px; }
        .footer-links a { color: #666; text-decoration: none; border: 1px solid #ddd; padding: 4px 10px; border-radius: 15px; }

        .empty-box { text-align: center; padding: 50px 0; color: #bdc3c7; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="user-info">
                <div>
                    <div class="greeting">ë°˜ê°€ì›Œìš”! ì˜¤ëŠ˜ì˜ ìˆ˜ìµì„ í™•ì¸í•˜ì„¸ìš”</div>
                    <div class="cash-display"><span id="userCash">0</span><span class="cash-unit">ì›</span></div>
                </div>
                <div style="font-size: 24px;">ğŸ’</div>
            </div>
        </div>

        <div class="banner-section">
            <div class="banner-slider">
                <div class="banner-container" id="bannerContainer"></div>
            </div>
        </div>

        <div class="missions-section">
            <div class="section-header">
                <div class="section-title">ì‹¤ì‹œê°„ ë¯¸ì…˜ ğŸ”¥</div>
                <a href="missions.html" class="view-all">ì „ì²´ë³´ê¸°</a>
            </div>
            <div id="missionsList"></div>
        </div>

        <div class="footer">
            <div class="footer-links">
                <a href="http://www.cashdet.kro.kr/g1.html" target="_blank">ì´ìš©ì•½ê´€</a>
                <a href="http://www.cashdet.kro.kr/g2.html" target="_blank" style="font-weight: bold;">ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</a>
            </div>
            <p><strong>ì„œë¹„ìŠ¤ëª…:</strong> ìºì‹œëƒ (CashDet)</p>
            <p>ìš´ì˜ì/ë³´í˜¸ì±…ì„ì: SE7 | feelbox.gsh@gmail.com</p>
            <p style="margin-top: 8px; color: #ccc;">ë³¸ ì„œë¹„ìŠ¤ëŠ” í•™ìŠµ ë° í…ŒìŠ¤íŠ¸ ëª©ì ìœ¼ë¡œ ìš´ì˜ë˜ëŠ” ë² íƒ€ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.</p>
        </div>
    </div>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item active"><span class="nav-icon">ğŸ </span><span class="nav-label">í™ˆ</span></a>
        <a href="missions.html" class="nav-item"><span class="nav-icon">ğŸ¯</span><span class="nav-label">ë¯¸ì…˜</span></a>
        <a href="shop.html" class="nav-item"><span class="nav-icon">ğŸ›ï¸</span><span class="nav-label">ìƒì </span></a>
        <a href="attendance.html" class="nav-item"><span class="nav-icon">ğŸ“…</span><span class="nav-label">ì¶œì„</span></a>
        <a href="me.html" class="nav-item"><span class="nav-icon">ğŸ‘¤</span><span class="nav-label">ë§ˆì´</span></a>
    </nav>

    <script>
        const S_URL = 'https://apuiydnqimlmeqpftijl.supabase.co';
        const S_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwdWl5ZG5xaW1sbWVxcGZ0aWpsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1MTgzMDAsImV4cCI6MjA4NTA5NDMwMH0.G7CvTQLEsIzkhJfsa67ou28Pbt8J5bkbEvyEgSRziXI';

        document.addEventListener('DOMContentLoaded', async () => {
            const userId = localStorage.getItem('userId');
            if (!userId) return location.href = 'login.html';
            
            loadUserData(userId);
            loadBanners();
            loadMissions(userId);
        });

        async function loadUserData(userId) {
            const res = await fetch(`${S_URL}/rest/v1/users?id=eq.${userId}`, { headers: { 'apikey': S_KEY } });
            const data = await res.json();
            if (data[0]) document.getElementById('userCash').innerText = data[0].cash.toLocaleString();
        }

        async function loadBanners() {
            const res = await fetch(`${S_URL}/rest/v1/home_banners?is_active=eq.true`, { headers: { 'apikey': S_KEY } });
            const data = await res.json();
            const container = document.getElementById('bannerContainer');
            if (data.length > 0) {
                container.innerHTML = data.map(b => `<div class="banner-slide"><img src="${b.image_url}" class="banner-image"></div>`).join('');
                // ìë™ ìŠ¬ë¼ì´ë“œ ë¡œì§ (ê°„ë‹¨íˆ)
                let idx = 0;
                setInterval(() => {
                    idx = (idx + 1) % data.length;
                    container.style.transform = `translateX(-${idx * 100}%)`;
                }, 4000);
            }
        }

        async function loadMissions(userId) {
            const resM = await fetch(`${S_URL}/rest/v1/missions?is_active=eq.true&limit=4`, { headers: { 'apikey': S_KEY } });
            const missions = await resM.json();
            
            const resC = await fetch(`${S_URL}/rest/v1/user_missions?user_id=eq.${userId}`, { headers: { 'apikey': S_KEY } });
            const completed = await resC.json();
            const completedIds = completed.map(c => c.mission_id);

            const list = document.getElementById('missionsList');
            const available = missions.filter(m => !completedIds.includes(m.id));

            if (available.length === 0) {
                list.innerHTML = '<div class="empty-box">í˜„ì¬ ì°¸ì—¬ ê°€ëŠ¥í•œ ë¯¸ì…˜ì´ ì—†ì–´ìš” ğŸ’¨</div>';
            } else {
                list.innerHTML = available.map(m => `
                    <div class="mission-card" onclick="location.href='missions.html?id=${m.id}'">
                        <img src="${m.banner_url}" class="mission-img">
                        <div class="mission-info">
                            <div class="mission-name">${m.title}</div>
                            <div class="mission-tag">â± 10ì´ˆ ì‹œì²­í•˜ê³  ì ë¦½</div>
                        </div>
                        <div class="reward-badge">+${m.cash_reward}ì›</div>
                    </div>
                `).join('');
            }
        }
    </script>
</body>
</html>
