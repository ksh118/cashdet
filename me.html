<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>codetbase | ë‚´ ì •ë³´</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { margin: 0; font-family: sans-serif; background: #f4f7ff; }
        .top { background: #0052D4; color: white; padding: 40px 20px; border-radius: 0 0 30px 30px; text-align: center; }
        .card { background: white; margin: -20px 20px 20px; padding: 20px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .menu { padding: 15px 0; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; }
        input { padding: 8px; border: 1px solid #ddd; border-radius: 8px; width: 60%; }
        button { padding: 8px 15px; background: #0052D4; color: white; border: none; border-radius: 8px; cursor: pointer; }
        .nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: white; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; }
    </style>
</head>
<body>

<div class="top">
    <h2 id="m-nick" style="margin:0">íšŒì›ë‹˜</h2>
    <div id="m-cash" style="font-size:36px; font-weight:bold; margin-top:10px;">0 c</div>
</div>

<div class="card">
    <h3>ê³„ì • ì„¤ì •</h3>
    <div class="menu">
        <span>ë‹‰ë„¤ì„</span>
        <div>
            <input type="text" id="new-nick">
            <button onclick="saveNick()">ë³€ê²½</button>
        </div>
    </div>
    <div class="menu" style="border:none;">
        <span>ë¡œê·¸ì•„ì›ƒ</span>
        <span onclick="logout()" style="color:red; cursor:pointer;">Logout â†’</span>
    </div>
</div>

<div class="nav">
    <div onclick="location.href='index.html'">ğŸ <br>í™ˆ</div>
    <div onclick="location.href='m.html'">ğŸ’°<br>ë¯¸ì…˜</div>
    <div onclick="location.href='me.html'">ğŸ‘¤<br>ë‚´ì •ë³´</div>
</div>

<script>
    const client = supabase.createClient('URL', 'KEY');

    async function load() {
        const { data: { session } } = await client.auth.getSession();
        if(!session) return location.href='index.html';
        const { data: p } = await client.from('profiles').select('*').eq('id', session.user.id).single();
        document.getElementById('m-nick').innerText = p.nickname || 'íšŒì›ë‹˜';
        document.getElementById('m-cash').innerText = p.cash.toLocaleString() + ' c';
    }

    async function saveNick() {
        const { data: { session } } = await client.auth.getSession();
        const nick = document.getElementById('new-nick').value;
        await client.from('profiles').update({ nickname: nick }).eq('id', session.user.id);
        alert("ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤."); location.reload();
    }

    async function logout() { await client.auth.signOut(); location.href='index.html'; }
    load();
</script>
</body>
</html>
