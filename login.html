<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="adpick-auth" content="여기에_애드픽_코드를_넣으세요">
    
    <title>캐시뎃 Log In</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background-color: #f8f9fa; }
        .auth-container { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); width: 100%; max-width: 380px; text-align: center; }
        h1 { font-size: 24px; font-weight: bold; margin-bottom: 30px; color: #1a1a1b; }
        .input-group { margin-bottom: 15px; position: relative; }
        input { width: 100%; padding: 15px; border: 1px solid #e1e1e1; border-radius: 10px; font-size: 16px; box-sizing: border-box; outline: none; transition: 0.3s; }
        input:focus { border-color: #007bff; }
        .main-btn { width: 100%; padding: 15px; background: #007bff; color: white; border: none; border-radius: 10px; font-size: 17px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .toggle-btn { margin-top: 20px; color: #007bff; cursor: pointer; font-size: 14px; text-decoration: none; display: inline-block; }
        .divider { margin: 30px 0; border-bottom: 1px solid #eee; position: relative; }
        .divider::after { content: 'or'; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: white; padding: 0 15px; color: #999; font-size: 14px; }
        .google-btn { width: 100%; padding: 12px; background: white; border: 1px solid #ddd; border-radius: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; cursor: pointer; font-size: 16px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="auth-container">
    <h1 id="auth-title">캐시뎃 Log In</h1>
    
    <form id="auth-form">
        <div class="input-group">
            <input type="email" id="email" placeholder="이메일" required>
        </div>
        <div class="input-group hidden" id="nickname-group">
            <input type="text" id="nickname" placeholder="닉네임 (한글/영/숫 2~10자)">
        </div>
        <div class="input-group">
            <input type="password" id="password" placeholder="비밀번호 (대소문자/숫자/특수 포함 8~16자)" required>
        </div>
        <button type="submit" id="submit-btn" class="main-btn">Log In</button>
    </form>

    <div class="toggle-btn" id="toggle-auth">계정이 없으신가요? 회원가입</div>

    <div class="divider"></div>

    <button type="button" class="google-btn" id="google-login">
        <img src="https://www.google.com/favicon.ico" width="18"> Google로 시작하기
    </button>
</div>

<script>
    // Supabase 설정
    const SUPABASE_URL = 'https://apuiydnqimlmeqpftijl.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFwdWl5ZG5xaW1sbWVxcGZ0aWpsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk1MTgzMDAsImV4cCI6MjA4NTA5NDMwMH0.G7CvTQLEsIzkhJfsa67ou28Pbt8J5bkbEvyEgSRziXI';
    const client = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    let isSignUp = false;

    // UI 전환 로직
    const toggleBtn = document.getElementById('toggle-auth');
    const authTitle = document.getElementById('auth-title');
    const nicknameGroup = document.getElementById('nickname-group');
    const submitBtn = document.getElementById('submit-btn');

    toggleBtn.addEventListener('click', () => {
        isSignUp = !isSignUp;
        authTitle.innerText = isSignUp ? '캐시뎃 회원가입' : '캐시뎃 Log In';
        submitBtn.innerText = isSignUp ? '회원가입 하기' : 'Log In';
        toggleBtn.innerText = isSignUp ? '이미 계정이 있으신가요? 로그인' : '계정이 없으신가요? 회원가입';
        nicknameGroup.classList.toggle('hidden');
    });

    // 폼 제출 로직
    document.getElementById('auth-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const nickname = document.getElementById('nickname').value;

        // 유효성 검사
        const pwRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,16}$/;
        const nickRegex = /^[가-힣a-zA-Z0-9]{2,10}$/;

        if (!pwRegex.test(password)) {
            alert("비밀번호는 영문 대/소문자, 숫자, 특수문자를 포함해 8~16자여야 합니다.");
            return;
        }

        if (isSignUp) {
            if (!nickRegex.test(nickname)) {
                alert("닉네임은 한글, 영어, 숫자만 가능하며 2~10자여야 합니다.");
                return;
            }
            const { error } = await client.auth.signUp({ 
                email, password, options: { data: { display_name: nickname } } 
            });
            if (error) alert(error.message);
            else alert("회원가입 성공! 로그인을 진행하세요.");
        } else {
            const { error } = await client.auth.signInWithPassword({ email, password });
            if (error) alert("로그인 실패: 정보를 확인하세요.");
            else window.location.href = '/home'; // 로그인 성공 시 이동
        }
    });

    // 자동 로그인 체크
    async function checkSession() {
        const { data: { session } } = await client.auth.getSession();
        if (session) window.location.href = '/home';
    }
    checkSession();
</script>

</body>
</html>
